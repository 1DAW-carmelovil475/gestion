<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Gestión | Hola Informática</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0047b3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="./css/gestion_usuarios.css">
    <link rel="stylesheet" href="./css/gestion_it.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
    <div class="logo">
        <img src="./img/logoHola.png" alt="Logo Hola Informática">
        <span class="logo-text">Hola Informática</span>
    </div>

    <nav class="top-nav">
        <a href="#empresas" class="nav-link active" data-section="empresas">
            <i class="fas fa-building"></i> Empresas
        </a>
        <a href="#usuarios" class="nav-link" data-section="usuarios" data-admin-only>
            <i class="fas fa-users-cog"></i> Usuarios
        </a>

        <!-- DESACTIVADO — Contratos
        <a href="#contratos" class="nav-link" data-section="contratos">
            <i class="fas fa-file-contract"></i> Contratos
        </a>
        -->
        <!-- DESACTIVADO — Facturas
        <a href="#facturas" class="nav-link" data-section="facturas">
            <i class="fas fa-file-invoice-dollar"></i> Facturas
        </a>
        -->
       <!-- Reemplaza el enlace de Tickets en top-nav -->
        <a href="tickets.html" class="nav-link">
            <i class="fas fa-headset"></i> Tickets
        </a>
        <a href="estadisticas.html" class="nav-link" data-admin-only>
            <i class="fas fa-chart-bar"></i> Estadísticas
        </a>
    </nav>

    <div class="user-area">
        <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span id="usuarioNombre" class="user-name-text">Admin</span>
        </div>
        <button id="logoutBtn" class="btn-logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="logout-text">Salir</span>
        </button>
    </div>
</header>

<!-- BOTTOM NAV MOBILE -->
<nav class="bottom-nav">
    <a class="bottom-nav-item active" data-section="empresas">
        <i class="fas fa-building"></i>
        <span>Empresas</span>
    </a>
    <a class="bottom-nav-item" data-section="usuarios" data-admin-only>
        <i class="fas fa-users-cog"></i>
        <span>Usuarios</span>
    </a>
    <!-- DESACTIVADO — Contratos
    <a class="bottom-nav-item" data-section="contratos">
        <i class="fas fa-file-contract"></i>
        <span>Contratos</span>
    </a>
    -->
    <!-- DESACTIVADO — Facturas
    <a class="bottom-nav-item" data-section="facturas">
        <i class="fas fa-file-invoice-dollar"></i>
        <span>Facturas</span>
    </a>
    -->
    <!-- Reemplaza el item de Tickets en bottom-nav -->
    <a href="tickets.html" class="bottom-nav-item">
        <i class="fas fa-headset"></i>
        <span>Tickets</span>
    </a>
    <a href="estadisticas.html" class="bottom-nav-item" data-admin-only>
        <i class="fas fa-chart-bar"></i>
        <span>Estadísticas</span>
    </a>
</nav>

<main class="main-content">

<!-- ============ SECTION: EMPRESAS ============ -->
<section id="empresas" class="content-section active">
    <div class="section-header">
        <div>
            <h1><i class="fas fa-building"></i> Empresas</h1>
            <p>Gestión integral de clientes</p>
        </div>
        <div class="header-actions">
            <button id="exportBtn" class="btn-secondary btn-icon-only" onclick="exportToExcel()" title="Exportar Excel">
                <i class="fas fa-file-excel"></i>
                <span class="btn-label">Exportar</span>
            </button>
            <button class="btn-secondary btn-icon-only" onclick="importExcel()" title="Importar Excel">
                <i class="fas fa-file-import"></i>
                <span class="btn-label">Importar</span>
            </button>
            <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display:none">
            <button id="addCompanyBtn" class="btn-primary">
                <i class="fas fa-plus"></i>
                <span class="btn-label">Nueva</span>
            </button>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-icon" style="background:#dbeafe;color:#2563eb"><i class="fas fa-building"></i></div>
            <div class="stat-info"><h3 id="totalEmpresas">0</h3><p>Total</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#dcfce7;color:#16a34a"><i class="fas fa-check-circle"></i></div>
            <div class="stat-info"><h3 id="empresasActivas">0</h3><p>Activos</p></div>
        </div>
    </div>

    <div class="alerts-container" id="alertsContainer"></div>

    <div class="filters">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Buscar empresa, CIF, email...">
        </div>
        <div class="filter-row">
            <select id="statusFilter">
                <option value="all">Estado</option>
                <option value="Activo">Activo</option>
                <option value="En revisión">En revisión</option>
                <option value="Suspendido">Suspendido</option>
            </select>
            <select id="serviceFilter">
                <option value="all">Servicio</option>
                <option value="Cloud">Cloud</option>
                <option value="Soporte">Soporte</option>
                <option value="Hardware">Hardware</option>
                <option value="Redes">Redes</option>
                <option value="Seguridad">Seguridad</option>
            </select>
        </div>
    </div>

    <div class="table-container desktop-only">
        <table>
            <thead>
                <tr>
                    <th>Empresa</th><th>CIF</th><th>Email</th><th>Teléfono</th>
                    <th>Servicios</th><th>Estado</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody id="companyTable"></tbody>
        </table>
    </div>

    <div class="cards-list mobile-only" id="companyCards"></div>
    <div class="pagination" id="pagination"></div>
</section>

<!-- ============ SECTION: EMPRESA DETALLE ============ -->
<section id="empresa-detalle" class="content-section">
    <div class="empresa-detalle-header">
        <button class="btn-back" onclick="volverAEmpresas()">
            <i class="fas fa-arrow-left"></i> Volver
        </button>
        <h1 id="empresaDetalleTitulo"><i class="fas fa-building"></i> Empresa</h1>
        <button class="btn-primary btn-sm" id="empresaDetalleEditBtn">
            <i class="fas fa-edit"></i> <span>Editar</span>
        </button>
    </div>

    <div class="empresa-info-grid" id="empresaInfoGrid"></div>

    <div class="it-page-section">
        <div class="it-tabs-wrapper">
            <div class="it-tabs" id="itTabsPage">
                <button class="it-tab active" data-tab="equipos"><i class="fas fa-desktop"></i> <span>Equipos</span></button>
                <button class="it-tab" data-tab="servidores"><i class="fas fa-server"></i> <span>Servidores</span></button>
                <button class="it-tab" data-tab="nas"><i class="fas fa-hdd"></i> <span>NAS</span></button>
                <button class="it-tab" data-tab="redes"><i class="fas fa-network-wired"></i> <span>Redes</span></button>
                <button class="it-tab" data-tab="correos"><i class="fas fa-envelope"></i> <span>Correos</span></button>
                <button class="it-tab" data-tab="otros"><i class="fas fa-boxes"></i> <span>Otros</span></button>
            </div>
        </div>
        <div id="itContent"></div>
    </div>
</section>

<!-- ============ SECTION: CONTRATOS (DESACTIVADO) ============ -->
<!--
<section id="contratos" class="content-section">
    <div class="section-header">
        <div>
            <h1><i class="fas fa-file-contract"></i> Contratos</h1>
            <p>Seguimiento de contratos activos</p>
        </div>
        <button id="addContractBtn" class="btn-primary">
            <i class="fas fa-plus"></i> <span class="btn-label">Nuevo</span>
        </button>
    </div>
    <div class="stats">
        <div class="stat-card">
            <div class="stat-icon" style="background:#dbeafe;color:#2563eb"><i class="fas fa-file-signature"></i></div>
            <div class="stat-info"><h3 id="totalContratos">0</h3><p>Total</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#dcfce7;color:#16a34a"><i class="fas fa-check"></i></div>
            <div class="stat-info"><h3 id="contratosActivos">0</h3><p>Activos</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#fee2e2;color:#dc2626"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="stat-info"><h3 id="contratosPorVencer">0</h3><p>Por Vencer</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#f3e8ff;color:#9333ea"><i class="fas fa-euro-sign"></i></div>
            <div class="stat-info"><h3 id="facturacionTotal">0€</h3><p>Valor Total</p></div>
        </div>
    </div>
    <div class="table-container desktop-only">
        <table>
            <thead>
                <tr>
                    <th>Empresa</th><th>Tipo</th><th>Inicio</th>
                    <th>Fin</th><th>Valor</th><th>Estado</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody id="contractsTable"></tbody>
        </table>
    </div>
    <div class="cards-list mobile-only" id="contractsCards"></div>
</section>
-->

<!-- ============ SECTION: FACTURAS (DESACTIVADO) ============ -->
<!--
<section id="facturas" class="content-section">
    <div class="section-header">
        <div>
            <h1><i class="fas fa-file-invoice-dollar"></i> Facturas</h1>
            <p>Seguimiento de pagos</p>
        </div>
        <button id="addInvoiceBtn" class="btn-primary">
            <i class="fas fa-plus"></i> <span class="btn-label">Nueva</span>
        </button>
    </div>
    <div class="stats">
        <div class="stat-card">
            <div class="stat-icon" style="background:#dbeafe;color:#2563eb"><i class="fas fa-file-invoice"></i></div>
            <div class="stat-info"><h3 id="totalFacturas">0</h3><p>Total</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#dcfce7;color:#16a34a"><i class="fas fa-check-circle"></i></div>
            <div class="stat-info"><h3 id="facturasPagadas">0</h3><p>Pagadas</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#fee2e2;color:#dc2626"><i class="fas fa-times-circle"></i></div>
            <div class="stat-info"><h3 id="facturasPendientes">0</h3><p>Pendientes</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#fef3c7;color:#d97706"><i class="fas fa-exclamation-circle"></i></div>
            <div class="stat-info"><h3 id="facturasVencidas">0</h3><p>Vencidas</p></div>
        </div>
    </div>
    <div class="table-container desktop-only">
        <table>
            <thead>
                <tr>
                    <th>Nº Factura</th><th>Empresa</th><th>Fecha</th>
                    <th>Importe</th><th>Estado</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody id="invoicesTable"></tbody>
        </table>
    </div>
    <div class="cards-list mobile-only" id="invoicesCards"></div>
</section>
-->

<!-- ============ SECTION: TICKETS ============ -->
<section id="soporte" class="content-section">
    <div class="section-header">
        <div>
            <h1><i class="fas fa-headset"></i> Tickets</h1>
            <p>Gestión de incidencias</p>
        </div>
        <button id="addTicketBtn" class="btn-primary">
            <i class="fas fa-plus"></i> <span class="btn-label">Nuevo</span>
        </button>
    </div>
    <div class="stats">
        <div class="stat-card">
            <div class="stat-icon" style="background:#dbeafe;color:#2563eb"><i class="fas fa-ticket-alt"></i></div>
            <div class="stat-info"><h3 id="totalTickets">0</h3><p>Total</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#fef3c7;color:#d97706"><i class="fas fa-spinner"></i></div>
            <div class="stat-info"><h3 id="ticketsAbiertos">0</h3><p>Abiertos</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#dcfce7;color:#16a34a"><i class="fas fa-check"></i></div>
            <div class="stat-info"><h3 id="ticketsCerrados">0</h3><p>Cerrados</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#fee2e2;color:#dc2626"><i class="fas fa-exclamation-circle"></i></div>
            <div class="stat-info"><h3 id="ticketsUrgentes">0</h3><p>Urgentes</p></div>
        </div>
    </div>
    <div class="table-container desktop-only">
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>Empresa</th><th>Asunto</th>
                    <th>Prioridad</th><th>Estado</th><th>Fecha</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody id="ticketsTable"></tbody>
        </table>
    </div>
    <div class="cards-list mobile-only" id="ticketsCards"></div>
</section>

<!-- ============ SECTION: USUARIOS (solo admin) ============ -->
<section id="usuarios" class="content-section" data-admin-only>
    <div class="section-header">
        <div>
            <h1><i class="fas fa-users-cog"></i> Usuarios</h1>
            <p>Gestión de accesos al panel</p>
        </div>
        <button id="addUserBtn" class="btn-primary" onclick="openUserModal()">
            <i class="fas fa-plus"></i>
            <span class="btn-label">Nuevo</span>
        </button>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-icon" style="background:#dbeafe;color:#2563eb"><i class="fas fa-users"></i></div>
            <div class="stat-info"><h3 id="totalUsuarios">0</h3><p>Total</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#f3e8ff;color:#9333ea"><i class="fas fa-user-shield"></i></div>
            <div class="stat-info"><h3 id="totalAdmins">0</h3><p>Admins</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background:#dcfce7;color:#16a34a"><i class="fas fa-user-check"></i></div>
            <div class="stat-info"><h3 id="totalTrabajadores">0</h3><p>Trabajadores</p></div>
        </div>
    </div>

    <div class="table-container desktop-only">
        <table>
            <thead>
                <tr>
                    <th>Nombre</th><th>Email</th><th>Rol</th>
                    <th>Estado</th><th>Creado</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody id="usersTable"></tbody>
        </table>
    </div>

    <div class="cards-list mobile-only" id="usersCards"></div>
</section>

<!-- MODAL: CREAR USUARIO -->
<div class="modal" id="userModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="userModalTitle">Nuevo Usuario</h2>
            <button class="modal-close" onclick="closeUserModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="editUserId">
            <div class="form-group">
                <label>Nombre completo *</label>
                <input type="text" id="userNombre" placeholder="María García" required>
            </div>
            <div class="form-group" id="userEmailGroup">
                <label>Email *</label>
                <input type="email" id="userEmail" placeholder="maria@holainformatica.com" required>
            </div>
            <div class="form-group">
                <label>Rol *</label>
                <select id="userRol">
                    <option value="trabajador">Trabajador</option>
                    <option value="admin">Administrador</option>
                </select>
            </div>
            <div class="form-group" id="userActivoGroup" style="display:none">
                <label>Estado</label>
                <select id="userActivo">
                    <option value="true">Activo</option>
                    <option value="false">Desactivado</option>
                </select>
            </div>
            <div id="userPasswordInfo" style="display:none;background:#f0fdf4;border:1.5px solid #bbf7d0;border-radius:10px;padding:14px 16px;margin-top:8px">
                <p style="font-size:0.85rem;color:#166534;font-weight:600;margin-bottom:6px">
                    <i class="fas fa-key"></i> Contraseña generada:
                </p>
                <code id="userPasswordText" style="font-size:1rem;color:#15803d;background:#dcfce7;padding:4px 10px;border-radius:6px;display:block;text-align:center;letter-spacing:2px"></code>
                <p style="font-size:0.78rem;color:#16a34a;margin-top:8px">
                    <i class="fas fa-envelope"></i> Se enviará por email al usuario automáticamente.
                </p>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="btn-primary" onclick="saveUser()"><i class="fas fa-save"></i> Guardar</button>
            <button class="btn-secondary" onclick="closeUserModal()">Cancelar</button>
        </div>
    </div>
</div>

</main>

<!-- ============================= MODALES ============================= -->

<!-- MODAL: EMPRESA (crear/editar) -->
<div class="modal" id="companyModal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="companyModalTitle">Nueva Empresa</h2>
            <button class="modal-close" onclick="closeCompanyModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="companyForm">
            <input type="hidden" id="editCompanyIndex">
            <div class="form-tabs">
                <button type="button" class="form-tab active" data-tab="datos">Datos</button>
                <button type="button" class="form-tab" data-tab="servicios">Servicios</button>
                <button type="button" class="form-tab" data-tab="contactos">Contactos</button>
            </div>
            <div class="form-tab-content active" id="tab-datos">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="newName" placeholder="Tech Solutions SL" required>
                    </div>
                    <div class="form-group">
                        <label>CIF *</label>
                        <input type="text" id="newCif" placeholder="B12345678" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="newEmail" placeholder="contacto@empresa.com" required>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="tel" id="newPhone" placeholder="912345678">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Dirección</label>
                        <input type="text" id="newAddress" placeholder="Calle, número, ciudad">
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="newStatus">
                            <option value="Activo">Activo</option>
                            <option value="En revisión">En revisión</option>
                            <option value="Suspendido">Suspendido</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="newNotes" placeholder="Observaciones adicionales..."></textarea>
                </div>
            </div>
            <div class="form-tab-content" id="tab-servicios">
                <div class="services-grid">
                    <label class="service-checkbox">
                        <input type="checkbox" name="services" value="Cloud">
                        <span class="checkmark"><i class="fas fa-cloud"></i></span>
                        <span>Cloud</span>
                    </label>
                    <label class="service-checkbox">
                        <input type="checkbox" name="services" value="Soporte">
                        <span class="checkmark"><i class="fas fa-headset"></i></span>
                        <span>Soporte</span>
                    </label>
                    <label class="service-checkbox">
                        <input type="checkbox" name="services" value="Hardware">
                        <span class="checkmark"><i class="fas fa-server"></i></span>
                        <span>Hardware</span>
                    </label>
                    <label class="service-checkbox">
                        <input type="checkbox" name="services" value="Redes">
                        <span class="checkmark"><i class="fas fa-network-wired"></i></span>
                        <span>Redes</span>
                    </label>
                    <label class="service-checkbox">
                        <input type="checkbox" name="services" value="Seguridad">
                        <span class="checkmark"><i class="fas fa-shield-alt"></i></span>
                        <span>Seguridad</span>
                    </label>
                    <label class="service-checkbox">
                        <input type="checkbox" name="services" value="Backup">
                        <span class="checkmark"><i class="fas fa-database"></i></span>
                        <span>Backup</span>
                    </label>
                </div>
            </div>
            <div class="form-tab-content" id="tab-contactos">
                <div id="contactsContainer">
                    <div class="contact-row">
                        <input type="text" placeholder="Nombre" class="contact-name">
                        <input type="tel" placeholder="Teléfono" class="contact-phone">
                        <input type="email" placeholder="Email" class="contact-email">
                        <input type="text" placeholder="Cargo" class="contact-role">
                        <button type="button" class="btn-remove-contact" onclick="removeContactRow(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <button type="button" class="btn-add-contact" onclick="addContactRow()">
                    <i class="fas fa-plus"></i> Añadir Contacto
                </button>
            </div>
        </form>
        <div class="modal-buttons">
            <button type="button" class="btn-primary" onclick="saveCompany()">
                <i class="fas fa-save"></i> Guardar
            </button>
            <button type="button" class="btn-secondary" onclick="closeCompanyModal()">Cancelar</button>
        </div>
    </div>
</div>

<!-- MODAL: CONTRATO (DESACTIVADO) -->
<!--
<div class="modal" id="contractModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Nuevo Contrato</h2>
            <button class="modal-close" onclick="closeContractModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Empresa *</label>
                <select id="contractCompany" required></select>
            </div>
            <div class="form-group">
                <label>Tipo de Contrato *</label>
                <select id="contractType" required>
                    <option value="Mantenimiento Integral">Mantenimiento Integral</option>
                    <option value="Soporte Técnico">Soporte Técnico</option>
                    <option value="Cloud Services">Cloud Services</option>
                    <option value="Seguridad">Seguridad</option>
                    <option value="Redes e Infraestructura">Redes e Infraestructura</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Fecha Inicio *</label>
                    <input type="date" id="contractStart" required>
                </div>
                <div class="form-group">
                    <label>Fecha Fin *</label>
                    <input type="date" id="contractEnd" required>
                </div>
            </div>
            <div class="form-group">
                <label>Valor Anual (€) *</label>
                <input type="number" id="contractValue" placeholder="Ej: 1200" required>
            </div>
            <div class="form-group">
                <label>Notas</label>
                <textarea id="contractNotes" placeholder="Observaciones..."></textarea>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="btn-primary" onclick="saveContract()"><i class="fas fa-save"></i> Guardar</button>
            <button class="btn-secondary" onclick="closeContractModal()">Cancelar</button>
        </div>
    </div>
</div>
-->

<!-- MODAL: FACTURA (DESACTIVADO) -->
<!--
<div class="modal" id="invoiceModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Nueva Factura</h2>
            <button class="modal-close" onclick="closeInvoiceModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Número de Factura *</label>
                <input type="text" id="invoiceNumber" placeholder="FAC-2024-001" required>
            </div>
            <div class="form-group">
                <label>Empresa *</label>
                <select id="invoiceCompany" required></select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Fecha Emisión *</label>
                    <input type="date" id="invoiceDate" required>
                </div>
                <div class="form-group">
                    <label>Fecha Vencimiento *</label>
                    <input type="date" id="invoiceDueDate" required>
                </div>
            </div>
            <div class="form-group">
                <label>Importe (€) *</label>
                <input type="number" id="invoiceAmount" placeholder="150.00" step="0.01" required>
            </div>
            <div class="form-group">
                <label>Estado</label>
                <select id="invoiceStatus">
                    <option value="Pendiente">Pendiente</option>
                    <option value="Pagada">Pagada</option>
                    <option value="Vencida">Vencida</option>
                </select>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="btn-primary" onclick="saveInvoice()"><i class="fas fa-save"></i> Guardar</button>
            <button class="btn-secondary" onclick="closeInvoiceModal()">Cancelar</button>
        </div>
    </div>
</div>
-->

<!-- MODAL: TICKET -->
<div class="modal" id="ticketModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Nuevo Ticket</h2>
            <button class="modal-close" onclick="closeTicketModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Empresa *</label>
                <select id="ticketCompany" required></select>
            </div>
            <div class="form-group">
                <label>Asunto *</label>
                <input type="text" id="ticketSubject" placeholder="Describe el problema..." required>
            </div>
            <div class="form-group">
                <label>Descripción</label>
                <textarea id="ticketDescription" placeholder="Detalles adicionales..."></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Prioridad</label>
                    <select id="ticketPriority">
                        <option value="Baja">Baja</option>
                        <option value="Media">Media</option>
                        <option value="Alta">Alta</option>
                        <option value="Urgente">Urgente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <select id="ticketStatus">
                        <option value="Abierto">Abierto</option>
                        <option value="En proceso">En proceso</option>
                        <option value="Cerrado">Cerrado</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="btn-primary" onclick="saveTicket()"><i class="fas fa-save"></i> Guardar</button>
            <button class="btn-secondary" onclick="closeTicketModal()">Cancelar</button>
        </div>
    </div>
</div>

<!-- MODAL: DETALLE CONTRATO (DESACTIVADO) -->
<!--
<div class="modal" id="contractDetailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-file-contract" style="color:var(--primary);margin-right:8px"></i> Detalle del Contrato</h2>
            <button class="modal-close" onclick="document.getElementById('contractDetailModal').style.display='none'"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="contractDetailBody"></div>
        <div class="modal-buttons">
            <button class="btn-secondary" onclick="document.getElementById('contractDetailModal').style.display='none'">Cerrar</button>
        </div>
    </div>
</div>
-->

<!-- MODAL: DETALLE FACTURA (DESACTIVADO) -->
<!--
<div class="modal" id="invoiceDetailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-file-invoice-dollar" style="color:var(--primary);margin-right:8px"></i> Detalle de Factura</h2>
            <button class="modal-close" onclick="document.getElementById('invoiceDetailModal').style.display='none'"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="invoiceDetailBody"></div>
        <div class="modal-buttons">
            <button class="btn-secondary" onclick="document.getElementById('invoiceDetailModal').style.display='none'">Cerrar</button>
        </div>
    </div>
</div>
-->

<!-- MODAL: DETALLE TICKET -->
<div class="modal" id="ticketDetailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-headset" style="color:var(--primary);margin-right:8px"></i> Detalle del Ticket</h2>
            <button class="modal-close" onclick="document.getElementById('ticketDetailModal').style.display='none'"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="ticketDetailBody"></div>
        <div class="modal-buttons">
            <button class="btn-secondary" onclick="document.getElementById('ticketDetailModal').style.display='none'">Cerrar</button>
        </div>
    </div>
</div>

<!-- MODAL: AÑADIR ITEM IT -->
<div class="modal" id="itItemModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="itItemModalTitle">Añadir Item</h2>
            <button class="modal-close" onclick="closeITItemModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <form id="itItemForm" onsubmit="return false;"></form>
        </div>
        <div class="modal-buttons">
            <button class="btn-primary" id="saveITItemBtn" onclick="saveITItem()">
                <i class="fas fa-save"></i> Guardar
            </button>
            <button class="btn-secondary" onclick="closeITItemModal()">Cancelar</button>
        </div>
    </div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toastContainer"></div>

<script src="./js/config.js"></script>
<script>
(async function() {
    if (!sessionStorage.getItem('hola_token')) {
        window.location.replace('./index.html');
        return;
    }
    // Carga perfil, aplica restricciones de rol
    await initUserSession();
})();

document.getElementById('logoutBtn').addEventListener('click', function() {
    if (confirm('¿Cerrar sesión?')) {
        sessionStorage.clear();
        window.location.href = './index.html';
    }
});
</script>
<script>
(function() {
    if (!sessionStorage.getItem('hola_token')) {
        window.location.replace('./index.html');
    }
    const usuario = sessionStorage.getItem('hola_usuario');
    if (usuario) {
        const el = document.getElementById('usuarioNombre');
        if (el) el.textContent = usuario;
    }
})();

document.getElementById('logoutBtn').addEventListener('click', function() {
    if (confirm('¿Cerrar sesión?')) {
        sessionStorage.removeItem('hola_token');
        sessionStorage.removeItem('hola_usuario');
        window.location.href = './index.html';
    }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="./js/gestion_usuarios.js"></script>
</body>
</html>